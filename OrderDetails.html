<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order details by Employee</title>
    <!-- font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container form-group text-center bg-dark" style="border-radius: 8px;">
        <div class="col-sm-12 text-white">
            <h1>Order Details</h1>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label>Order Id (Mã đơn hàng) </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-order-id" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Cỡ Combo Menu </label>
            </div>
            <div class="col-sm-8">
                <select id="select-menu" class="w-100 text-center" style="border-radius: 8px;"></select>
            </div>
        </div>

        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Đường Kính Pizza </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-duong-kinh" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Sườn Nướng (Miếng) </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-suon-nuong" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Đồ Uống </label>
            </div>
            <div class="col-sm-8">
                <select id="select-type-drink" class="w-100 text-center" style="border-radius: 8px;"></select>
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Số lượng nước Uống </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-drink-number" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Voucher ID (Mã Voucher) </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-voucher-id" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Loại Pizza (Pizza type) </label>
            </div>
            <div class="col-sm-8">
                <select id="select-pizza-type" class="w-100 text-center" style="border-radius: 8px;"></select>
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Salar (gram) </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-salad" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Thành Tiền </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-thanh-tien" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Giảm Giá (Discount) </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-discount" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Họ và Tên </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-fullname" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Email </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-email" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Số điện thoại </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-phone-number" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Địa chỉ </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-address" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Lời nhắn </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-message" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Trạng thái đơn hàng </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-status" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Ngày tạo đơn </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-date-create" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 bg-dark text-white">
                <label> Ngày cập nhật </label>
            </div>
            <div class="col-sm-8">
                <input id="inp-date-update" class="w-100 text-center" style="border-radius: 8px;">
            </div>
        </div>
        <div class="col-sm-12 row">
            <div class="col-sm-4 form-group">
                <button id="btn-update" class="col-sm-12 btn btn-warning ">Update</button>
            </div>
            <div class="col-sm-8 form-group text-right">
                <button id="btn-cancel" class="col-sm-4 btn btn-warning ">Cancel</button>
            </div>
        </div>
    </div>
</body>
<script src="IndexData.js"></script>
<script>
"use strict";
/*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
/*** REGION 2 - Vùng gán / thực thi hàm xử lý sự kiện cho các elements */
onPageLoading();
/*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
// function autoload on pageload
//in: no params
//out: load option to select typepizza and drink, load option to menu, load data to form, and event to btn
function onPageLoading() {
    "use strict";
    let vOrderPromise = new Promise((resolve, reject) => {
        let vXmlHttp = new XMLHttpRequest();
        sendRequestToServer("GET", vXmlHttp, gBASE_URL.getDrinkListUrl(), true);
        vXmlHttp.onload = function () {
            if (vXmlHttp.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && vXmlHttp.status == gREQUEST_STATUS_OK) {
                resolve(JSON.parse(vXmlHttp.responseText));
            } else {
                reject("Cant load data to form");
            }
        }
    });
    vOrderPromise.then(
        (dataDrinkObj) => (loadOptionsToDrink(dataDrinkObj)),
        (error) => { console.log(error) }
    ).then(() => { loadOptionsToTypePizza() })
        .then(() => { loadOptionsToMenu() })
        .then(() => { loadDataToForm() })
        .then(() => { addEventListenerToBtn() })
}
/*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
//function to load data to form
//in: no param
//out : form got all info
function loadDataToForm() {
    "use strict";
    //1. read data
    let vUrl = new URL(window.location.href);
    let vIdObj = {
        id: vUrl.searchParams.get("id"),
        orderId: vUrl.searchParams.get("orderid"),
    }
    if (vIdObj.id !== null && vIdObj.orderId !== null) {
        console.log("Id: " + vIdObj.id);
        console.log("Order Id: " + vIdObj.orderId);
        let vXmlHttp = new XMLHttpRequest();
        // sendGetRequestToServer(vXmlHttp, vIdObj.orderId);
        sendRequestToServer("GET", vXmlHttp, gBASE_URL.getOrderById(vIdObj.orderId), true);
        //4.handle resposne
        handleResponseFromServer(vXmlHttp);
    }
}
//function to handle resposen from server
//in: xml http obj
//out: if there response text upload data to server
function handleResponseFromServer(paramXhttp) {
    "use strict";
    paramXhttp.onreadystatechange = function () {
        if (this.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && this.status == gREQUEST_STATUS_OK) {
            let bOrderReponse = JSON.parse(this.responseText);
            console.log(bOrderReponse);
            upLoadDataToForm(bOrderReponse);
        }
    }
}
//functin to update load data form from obj
//in : order obj
//out: form loaded data
function upLoadDataToForm(paramOrderObj) {
    "use strict";
    let vOrderId = document.getElementById("inp-order-id");
    let vMenu = document.getElementById("select-menu");
    let vDuongKinh = document.getElementById("inp-duong-kinh");
    let vSuonNuong = document.getElementById("inp-suon-nuong");
    let vDoUong = document.getElementById("select-type-drink");
    let vSoLuongNuocUong = document.getElementById("inp-drink-number");
    let vVoucherId = document.getElementById("inp-voucher-id");
    let vLoaiPizza = document.getElementById("select-pizza-type");
    let vSalad = document.getElementById("inp-salad");
    let vThanhTien = document.getElementById("inp-thanh-tien");
    let vGiamGia = document.getElementById("inp-discount");
    let vFullName = document.getElementById("inp-fullname");
    let vEmail = document.getElementById("inp-email");
    let vSoDienThoai = document.getElementById("inp-phone-number");
    let vDiaChi = document.getElementById("inp-address");
    let vLoiNhan = document.getElementById("inp-message");
    let vTrangThai = document.getElementById("inp-status");
    let vNgayTao = document.getElementById("inp-date-create");
    let vNgayCapNhat = document.getElementById("inp-date-update");
    // orderid
    vOrderId.value = paramOrderObj.orderId;
    //  menu size
    for (let bI = 0; bI < vMenu.options.length; bI++) {
        let vSingleOption = vMenu.options[bI];
        if (vSingleOption.value === paramOrderObj.kichCo) {
            vSingleOption.setAttribute("selected", "selected");
        }
    }
    // duongKinhCM
    vDuongKinh.value = paramOrderObj.duongKinh;
    // ssuong nuoc
    vSuonNuong.value = paramOrderObj.suon;
    // do uong
    for (let bI = 0; bI < vDoUong.options.length; bI++) {
        let vSingleOption = vDoUong.options[bI];
        if (vSingleOption.value.toUpperCase() === paramOrderObj.idLoaiNuocUong.toUpperCase()) {
            vSingleOption.setAttribute("selected", "selected");
        }
    }
    // so luong nuoc
    vSoLuongNuocUong.value = paramOrderObj.soLuongNuoc;
    // voucher id
    vVoucherId.value = paramOrderObj.idVourcher;
    // loai pizza
    for (let bI = 0; bI < vLoaiPizza.options.length; bI++) {
        let vSingleOption = vLoaiPizza.options[bI];
        if (vSingleOption.value.toUpperCase() === paramOrderObj.loaiPizza.toUpperCase()) {
            vSingleOption.setAttribute("selected", "selected");
        }
    }
    // salad
    vSalad.value = paramOrderObj.salad;
    // thanh tien
    vThanhTien.value = paramOrderObj.thanhTien;
    // giam gia
    vGiamGia.value = paramOrderObj.giamGia;
    // full name
    vFullName.value = paramOrderObj.hoTen;
    // email
    vEmail.value = paramOrderObj.email;
    // so dien thoai
    vSoDienThoai.value = paramOrderObj.soDienThoai;
    // dia chi
    vDiaChi.value = paramOrderObj.diaChi;
    // loi nhan
    vLoiNhan.value = paramOrderObj.loiNhan;
    // trang thai
    vTrangThai.value = paramOrderObj.trangThai;
    // ngay tao
    vNgayTao.value = new Date(paramOrderObj.ngayTao);
    // ngay cap nhat
    vNgayCapNhat.value = new Date(paramOrderObj.ngayCapNhat);
}
//function to load option to select drink
//in: drink obj
//out : load options to select drink
function loadOptionsToDrink(paramObj) {
    "use strict";
    let vDrinkTypeElement = document.getElementById("select-type-drink");
    for (let bI = 0; bI < paramObj.length; bI++) {
        let vOption = document.createElement("option");
        vOption.value = paramObj[bI].maNuocUong;
        vOption.text = paramObj[bI].tenNuocUong;
        vDrinkTypeElement.appendChild(vOption);
    }
}
// function to load optio to select pizza type
//in: no params
//out : load options to select pizza type
function loadOptionsToTypePizza() {
    "use strict";
    let vTypePizzaArray = ["HAWAII", "BACON", "SEAFOOD"];
    for (let bI = 0; bI < vTypePizzaArray.length; bI++) {
        let vOption = document.createElement("option");
        vOption.value = vTypePizzaArray[bI];
        vOption.text = vTypePizzaArray[bI];
        document.getElementById("select-pizza-type").appendChild(vOption);
    }
}
//function to load menu to select menu
//in : noparam
//out: load menu to select menu
function loadOptionsToMenu() {
    "use strict";
    let vMenuzie = ["S", "L", "M"];
    for (let bI = 0; bI < vMenuzie.length; bI++) {
        let vOption = document.createElement("option");
        vOption.value = vMenuzie[bI];
        vOption.text = vMenuzie[bI];
        document.getElementById("select-menu").appendChild(vOption)
    }
}
//function to add event to btn
//in :no prams
//out: confirm and cancel btn have click event
function addEventListenerToBtn() {
    "use strict";
    let vBtnUpdate = document.getElementById("btn-update");
    vBtnUpdate.addEventListener("click", function () {
        let vUrl = new URL(window.location.href);
        let vId = vUrl.searchParams.get("id");
        let vXmlHttp = new XMLHttpRequest();
        let vUpdateObj = {
            trangThai: "confirmed"
        }
        sendRequestToServer("PUT", vXmlHttp, gBASE_URL.getUpdateOrderUrl(vId), true, vUpdateObj);
        vXmlHttp.onreadystatechange = function () {
            if (this.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && this.status == gREQUEST_STATUS_OK) {
                console.log("Order đã đc update trạng thái confrimed");
                console.log(this.responseText);
            }
        }
    });
    let vBtnCancel = document.getElementById("btn-cancel");
    vBtnCancel.addEventListener("click", function () {
        let vUrl = new URL(window.location.href);
        let vId = vUrl.searchParams.get("id");
        let vXmlHttp = new XMLHttpRequest();
        let vUpdateObj = {
            trangThai: "Cancel",
        }
        sendRequestToServer("PUT", vXmlHttp, gBASE_URL.getUpdateOrderUrl(vId), true, vUpdateObj);
        vXmlHttp.onreadystatechange = function () {
            if (this.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && this.status == gREQUEST_STATUS_OK) {
                console.log("Order đã đc cancel trạng thái canceled");
                console.log(this.responseText);
            }
        }
    });
}
</script>
</html>